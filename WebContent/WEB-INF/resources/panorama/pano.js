"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window.libpannellum=function(e,t,o){function n(n){function r(e,t){return 1==e.level&&1!=t.level?-1:1==t.level&&1!=e.level?1:t.timestamp-e.timestamp}function h(e,t){return e.level!=t.level?e.level-t.level:e.diff-t.diff}function u(){if(!C.drawInProgress){C.drawInProgress=!0;for(var e=0;e<C.currentNodes.length;e++)C.currentNodes[e].textureLoaded&&(T.bindBuffer(T.ARRAY_BUFFER,U),T.bufferData(T.ARRAY_BUFFER,new Float32Array(C.currentNodes[e].vertices),T.STATIC_DRAW),T.vertexAttribPointer(C.vertPosLocation,3,T.FLOAT,!1,0,0),T.bindBuffer(T.ARRAY_BUFFER,z),T.vertexAttribPointer(C.texCoordLocation,2,T.FLOAT,!1,0,0),T.bindTexture(T.TEXTURE_2D,C.currentNodes[e].texture),T.drawElements(T.TRIANGLES,6,T.UNSIGNED_SHORT,0));C.drawInProgress=!1}}function d(e,t,o,n,a,i){this.vertices=e,this.side=t,this.level=o,this.x=n,this.y=a,this.path=i.replace("%s",t).replace("%l",o).replace("%x",n).replace("%y",a)}function p(e,t,o,n,a){if(E(e,t.vertices)){var i=t.vertices,r=i[0]+i[3]+i[6]+i[9],s=i[1]+i[4]+i[7]+i[10],l=i[2]+i[5]+i[8]+i[11],c=Math.sqrt(r*r+s*s+l*l),h=Math.asin(l/c),u=Math.atan2(s,r)-n;u+=u>Math.PI?-2*Math.PI:u<-Math.PI?2*Math.PI:0,u=Math.abs(u),t.diff=Math.acos(Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos(u));for(var f=!1,m=0;m<C.nodeCache.length;m++)if(C.nodeCache[m].path==t.path){f=!0,C.nodeCache[m].timestamp=C.nodeCacheTimestamp++,C.nodeCache[m].diff=t.diff,C.currentNodes.push(C.nodeCache[m]);break}if(f||(t.timestamp=C.nodeCacheTimestamp++,C.currentNodes.push(t),C.nodeCache.push(t)),t.level<C.level){var v=N.cubeResolution*Math.pow(2,t.level-N.maxLevel),g=Math.ceil(v*N.invTileResolution)-1,w=v%N.tileResolution*2,y=2*v%N.tileResolution;0===y&&(y=N.tileResolution),0===w&&(w=2*N.tileResolution);var b=.5;t.x!=g&&t.y!=g||(b=1-N.tileResolution/(N.tileResolution+y));var P,x=1-b,M=[],R=b,_=b,T=b,I=x,S=x,L=x;y<N.tileResolution&&(t.x==g&&t.y!=g?(_=.5,S=.5,"d"!=t.side&&"u"!=t.side||(T=.5,L=.5)):t.x!=g&&t.y==g&&(R=.5,I=.5,"l"!=t.side&&"r"!=t.side||(T=.5,L=.5))),w<=N.tileResolution&&(t.x==g&&(R=0,I=1,"l"!=t.side&&"r"!=t.side||(T=0,L=1)),t.y==g&&(_=0,S=1,"d"!=t.side&&"u"!=t.side||(T=0,L=1))),P=new d([i[0],i[1],i[2],i[0]*R+i[3]*I,i[1]*b+i[4]*x,i[2]*T+i[5]*L,i[0]*R+i[6]*I,i[1]*_+i[7]*S,i[2]*T+i[8]*L,i[0]*b+i[9]*x,i[1]*_+i[10]*S,i[2]*T+i[11]*L],t.side,t.level+1,2*t.x,2*t.y,N.fullpath),M.push(P),t.x==g&&w<=N.tileResolution||(P=new d([i[0]*R+i[3]*I,i[1]*b+i[4]*x,i[2]*T+i[5]*L,i[3],i[4],i[5],i[3]*b+i[6]*x,i[4]*_+i[7]*S,i[5]*T+i[8]*L,i[0]*R+i[6]*I,i[1]*_+i[7]*S,i[2]*T+i[8]*L],t.side,t.level+1,2*t.x+1,2*t.y,N.fullpath),M.push(P)),t.x==g&&w<=N.tileResolution||t.y==g&&w<=N.tileResolution||(P=new d([i[0]*R+i[6]*I,i[1]*_+i[7]*S,i[2]*T+i[8]*L,i[3]*b+i[6]*x,i[4]*_+i[7]*S,i[5]*T+i[8]*L,i[6],i[7],i[8],i[9]*R+i[6]*I,i[10]*b+i[7]*x,i[11]*T+i[8]*L],t.side,t.level+1,2*t.x+1,2*t.y+1,N.fullpath),M.push(P)),t.y==g&&w<=N.tileResolution||(P=new d([i[0]*b+i[9]*x,i[1]*_+i[10]*S,i[2]*T+i[11]*L,i[0]*R+i[6]*I,i[1]*_+i[7]*S,i[2]*T+i[8]*L,i[9]*R+i[6]*I,i[10]*b+i[7]*x,i[11]*T+i[8]*L,i[9],i[10],i[11]],t.side,t.level+1,2*t.x,2*t.y+1,N.fullpath),M.push(P));for(var A=0;A<M.length;A++)p(e,M[A],o,n,a)}}}function f(e,t,o){var n=Math.sin(t),a=Math.cos(t);return"x"==o?[e[0],a*e[1]+n*e[2],a*e[2]-n*e[1],e[3],a*e[4]+n*e[5],a*e[5]-n*e[4],e[6],a*e[7]+n*e[8],a*e[8]-n*e[7]]:"y"==o?[a*e[0]-n*e[2],e[1],a*e[2]+n*e[0],a*e[3]-n*e[5],e[4],a*e[5]+n*e[3],a*e[6]-n*e[8],e[7],a*e[8]+n*e[6]]:"z"==o?[a*e[0]+n*e[1],a*e[1]-n*e[0],e[2],a*e[3]+n*e[4],a*e[4]-n*e[3],e[5],a*e[6]+n*e[7],a*e[7]-n*e[6],e[8]]:void 0}function m(e){return[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]}function v(e){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]}function g(e,t,o,n){var a=2*Math.atan(Math.tan(e/2)*_.clientHeight/_.clientWidth),i=1/Math.tan(a/2);return[i/t,0,0,0,0,i,0,0,0,0,(n+o)/(o-n),2*n*o/(o-n),0,0,-1,0]}function w(e,t){T.bindTexture(T.TEXTURE_2D,t),T.texImage2D(T.TEXTURE_2D,0,T.RGB,T.RGB,T.UNSIGNED_BYTE,e),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.bindTexture(T.TEXTURE_2D,null)}function y(e){e.textureLoad||(e.textureLoad=!0,G(encodeURI(e.path+"."+N.extension),function(t){e.texture=t,e.textureLoaded=!0}))}function b(e){for(var t=1;t<N.maxLevel&&_.width>N.tileResolution*Math.pow(2,t-1)*Math.tan(e/2)*.707;)t++;C.level=t}function P(e,t){return[e[0]*t[0],e[0]*t[1],e[0]*t[2],0,e[5]*t[4],e[5]*t[5],e[5]*t[6],0,e[10]*t[8],e[10]*t[9],e[10]*t[10],e[11],-t[8],-t[9],-t[10],0]}function x(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[4]*t[0]+e[5]*t[1]+e[6]*t[2],e[11]+e[8]*t[0]+e[9]*t[1]+e[10]*t[2],1/(e[12]*t[0]+e[13]*t[1]+e[14]*t[2])]}function M(e,t){var o=x(e,t),n=o[0]*o[3],a=o[1]*o[3],i=o[2]*o[3],r=[0,0,0];return n<-1&&(r[0]=-1),n>1&&(r[0]=1),a<-1&&(r[1]=-1),a>1&&(r[1]=1),(i<-1||i>1)&&(r[2]=1),r}function E(e,t){var o=M(e,t.slice(0,3)),n=M(e,t.slice(3,6)),a=M(e,t.slice(6,9)),i=M(e,t.slice(9,12)),r=o[0]+n[0]+a[0]+i[0];if(-4==r||4==r)return!1;var s=o[1]+n[1]+a[1]+i[1];return-4!=s&&4!=s&&4!=o[2]+n[2]+a[2]+i[2]}function R(){console.log("Reducing canvas size due to error 1286!"),_.width=Math.round(_.width/2),_.height=Math.round(_.height/2)}var _=t.createElement("canvas");_.style.width=_.style.height="100%",n.appendChild(_);var C,T,I,S,L,A,D,k,N,O,H,F,U,z,B;this.init=function(e,r,h,u,d,p,f,m){if((void 0===r?"undefined":_typeof(r))===o&&(r="equirectangular"),"equirectangular"!=r&&"cubemap"!=r&&"multires"!=r)throw console.log("Error: invalid image type specified!"),{type:"config error"};if(O=r,N=e,H=h,C){if(I&&(T.detachShader(C,I),T.deleteShader(I)),S&&(T.detachShader(C,S),T.deleteShader(S)),T.bindBuffer(T.ARRAY_BUFFER,null),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,null),C.texture&&T.deleteTexture(C.texture),C.nodeCache)for(var v=0;v<C.nodeCache.length;v++)T.deleteTexture(C.nodeCache[v].texture);T.deleteProgram(C),C=o}k=o;var g;if("cubemap"==O&&0!=(N[0].width&N[0].width-1)&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(T||(T=_.getContext("experimental-webgl",{alpha:!1,depth:!1})),1286==T.getError()&&R()),!T&&("multires"==O&&N.hasOwnProperty("fallbackPath")||"cubemap"==O)&&("WebkitAppearance"in t.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||-1!==navigator.appVersion.indexOf("MSIE 10"))){A&&n.removeChild(A),(A=t.createElement("div")).className="pnlm-world";var w;w=N.basePath?N.basePath+N.fallbackPath:N.fallbackPath;var y=["f","r","b","l","u","d"],b=0,P=function(){var e=t.createElement("canvas");e.className="pnlm-face pnlm-"+y[this.side]+"face",A.appendChild(e);var o=e.getContext("2d");e.style.width=this.width+4+"px",e.style.height=this.height+4+"px",e.width=this.width+4,e.height=this.height+4,o.drawImage(this,2,2);var a,i,r=o.getImageData(0,0,e.width,e.height),s=r.data;for(a=2;a<e.width-2;a++)for(i=0;i<4;i++)s[4*(a+e.width)+i]=s[4*(a+2*e.width)+i],s[4*(a+e.width*(e.height-2))+i]=s[4*(a+e.width*(e.height-3))+i];for(a=2;a<e.height-2;a++)for(i=0;i<4;i++)s[4*(a*e.width+1)+i]=s[4*(a*e.width+2)+i],s[4*((a+1)*e.width-2)+i]=s[4*((a+1)*e.width-3)+i];for(i=0;i<4;i++)s[4*(e.width+1)+i]=s[4*(2*e.width+2)+i],s[4*(2*e.width-2)+i]=s[4*(3*e.width-3)+i],s[4*(e.width*(e.height-2)+1)+i]=s[4*(e.width*(e.height-3)+2)+i],s[4*(e.width*(e.height-1)-2)+i]=s[4*(e.width*(e.height-2)-3)+i];for(a=1;a<e.width-1;a++)for(i=0;i<4;i++)s[4*a+i]=s[4*(a+e.width)+i],s[4*(a+e.width*(e.height-1))+i]=s[4*(a+e.width*(e.height-2))+i];for(a=1;a<e.height-1;a++)for(i=0;i<4;i++)s[a*e.width*4+i]=s[4*(a*e.width+1)+i],s[4*((a+1)*e.width-1)+i]=s[4*((a+1)*e.width-2)+i];for(i=0;i<4;i++)s[i]=s[4*(e.width+1)+i],s[4*(e.width-1)+i]=s[4*(2*e.width-2)+i],s[e.width*(e.height-1)*4+i]=s[4*(e.width*(e.height-2)+1)+i],s[4*(e.width*e.height-1)+i]=s[4*(e.width*(e.height-1)-2)+i];o.putImageData(r,0,0),6==++b&&(L=this.width,n.appendChild(A),f())};for(g=0;g<6;g++){var x=new Image;x.crossOrigin="anonymous",x.side=g,x.onload=P,x.src="multires"==O?encodeURI(w.replace("%s",y[g])+"."+N.extension):encodeURI(N[g].src)}}else{if(!T)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};N.basePath?N.fullpath=N.basePath+N.path:N.fullpath=N.path,N.invTileResolution=1/N.tileResolution;var M=[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1];for(D=[],g=0;g<6;g++)D[g]=M.slice(12*g,12*g+12),M=[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1];var E,G;if("equirectangular"==O){if(E=Math.max(N.width,N.height),G=T.getParameter(T.MAX_TEXTURE_SIZE),E>G)throw console.log("Error: The image is too big; it's "+E+"px wide, but this device's maximum supported width is "+G+"px."),{type:"webgl size error",width:E,maxWidth:G}}else if("cubemap"==O&&(E=N[0].width,G=T.getParameter(T.MAX_CUBE_MAP_TEXTURE_SIZE),E>G))throw console.log("Error: The cube face image is too big; it's "+E+"px wide, but this device's maximum supported width is "+G+"px."),{type:"webgl size error",width:E,maxWidth:G};m===o||m.horizonPitch===o&&m.horizonRoll===o||(k=[m.horizonPitch==o?0:m.horizonPitch,m.horizonRoll==o?0:m.horizonRoll]);var Y=T.TEXTURE_2D;T.viewport(0,0,T.drawingBufferWidth,T.drawingBufferHeight),I=T.createShader(T.VERTEX_SHADER);var Z=a;"multires"==O&&(Z=i),T.shaderSource(I,Z),T.compileShader(I),S=T.createShader(T.FRAGMENT_SHADER);var W=l;if("cubemap"==O?(Y=T.TEXTURE_CUBE_MAP,W=s):"multires"==O&&(W=c),T.shaderSource(S,W),T.compileShader(S),C=T.createProgram(),T.attachShader(C,I),T.attachShader(C,S),T.linkProgram(C),T.getShaderParameter(I,T.COMPILE_STATUS)||console.log(T.getShaderInfoLog(I)),T.getShaderParameter(S,T.COMPILE_STATUS)||console.log(T.getShaderInfoLog(S)),T.getProgramParameter(C,T.LINK_STATUS)||console.log(T.getProgramInfoLog(C)),T.useProgram(C),C.drawInProgress=!1,C.texCoordLocation=T.getAttribLocation(C,"a_texCoord"),T.enableVertexAttribArray(C.texCoordLocation),"multires"!=O){if(F||(F=T.createBuffer()),T.bindBuffer(T.ARRAY_BUFFER,F),T.bufferData(T.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),T.STATIC_DRAW),T.vertexAttribPointer(C.texCoordLocation,2,T.FLOAT,!1,0,0),C.aspectRatio=T.getUniformLocation(C,"u_aspectRatio"),T.uniform1f(C.aspectRatio,_.clientWidth/_.clientHeight),C.psi=T.getUniformLocation(C,"u_psi"),C.theta=T.getUniformLocation(C,"u_theta"),C.f=T.getUniformLocation(C,"u_f"),C.h=T.getUniformLocation(C,"u_h"),C.v=T.getUniformLocation(C,"u_v"),C.vo=T.getUniformLocation(C,"u_vo"),C.rot=T.getUniformLocation(C,"u_rot"),T.uniform1f(C.h,u/(2*Math.PI)),T.uniform1f(C.v,d/Math.PI),T.uniform1f(C.vo,p/Math.PI*2),"equirectangular"==O){C.backgroundColor=T.getUniformLocation(C,"u_backgroundColor");var X=m.backgroundColor?m.backgroundColor:[0,0,0];T.uniform4fv(C.backgroundColor,X.concat([1]))}C.texture=T.createTexture(),T.bindTexture(Y,C.texture),"cubemap"==O?(T.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X,0,T.RGB,T.RGB,T.UNSIGNED_BYTE,N[1]),T.texImage2D(T.TEXTURE_CUBE_MAP_NEGATIVE_X,0,T.RGB,T.RGB,T.UNSIGNED_BYTE,N[3]),T.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_Y,0,T.RGB,T.RGB,T.UNSIGNED_BYTE,N[4]),T.texImage2D(T.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,T.RGB,T.RGB,T.UNSIGNED_BYTE,N[5]),T.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_Z,0,T.RGB,T.RGB,T.UNSIGNED_BYTE,N[0]),T.texImage2D(T.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,T.RGB,T.RGB,T.UNSIGNED_BYTE,N[2])):T.texImage2D(Y,0,T.RGB,T.RGB,T.UNSIGNED_BYTE,N),T.texParameteri(Y,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(Y,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texParameteri(Y,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(Y,T.TEXTURE_MAG_FILTER,T.LINEAR)}else C.vertPosLocation=T.getAttribLocation(C,"a_vertCoord"),T.enableVertexAttribArray(C.vertPosLocation),U||(U=T.createBuffer()),z||(z=T.createBuffer()),B||(B=T.createBuffer()),T.bindBuffer(T.ARRAY_BUFFER,z),T.bufferData(T.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),T.STATIC_DRAW),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,B),T.bufferData(T.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),T.STATIC_DRAW),C.perspUniform=T.getUniformLocation(C,"u_perspMatrix"),C.cubeUniform=T.getUniformLocation(C,"u_cubeMatrix"),C.level=-1,C.currentNodes=[],C.nodeCache=[],C.nodeCacheTimestamp=0;var q=T.getError();if(0!==q)throw console.log("Error: Something went wrong with WebGL!",q),{type:"webgl error"};f()}},this.destroy=function(){if(n!==o&&(_!==o&&n.removeChild(_),A!==o&&n.removeChild(A)),T){var e=T.getExtension("WEBGL_lose_context");e&&e.loseContext()}},this.resize=function(){var t=e.devicePixelRatio||1;_.width=_.clientWidth*t,_.height=_.clientHeight*t,T&&(1286==T.getError()&&R(),T.viewport(0,0,T.drawingBufferWidth,T.drawingBufferHeight),"multires"!=O&&T.uniform1f(C.aspectRatio,_.clientWidth/_.clientHeight))},this.resize(),this.render=function(e,t,n,a){var i,s,l=0;if(a===o&&(a={}),a.roll&&(l=a.roll),k!==o){var c=k[0],w=k[1],x=e,M=t,E=Math.cos(w)*Math.sin(e)*Math.sin(c)+Math.cos(e)*(Math.cos(c)*Math.cos(t)+Math.sin(w)*Math.sin(c)*Math.sin(t)),R=-Math.sin(e)*Math.sin(w)+Math.cos(e)*Math.cos(w)*Math.sin(t),I=Math.cos(w)*Math.cos(c)*Math.sin(e)+Math.cos(e)*(-Math.cos(t)*Math.sin(c)+Math.cos(c)*Math.sin(w)*Math.sin(t));e=Math.asin(Math.max(Math.min(I,1),-1)),t=Math.atan2(R,E);var S=[Math.cos(x)*(Math.sin(w)*Math.sin(c)*Math.cos(M)-Math.cos(c)*Math.sin(M)),Math.cos(x)*Math.cos(w)*Math.cos(M),Math.cos(x)*(Math.cos(c)*Math.sin(w)*Math.cos(M)+Math.sin(M)*Math.sin(c))],F=[-Math.cos(e)*Math.sin(t),Math.cos(e)*Math.cos(t)],U=Math.acos(Math.max(Math.min((S[0]*F[0]+S[1]*F[1])/(Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2])*Math.sqrt(F[0]*F[0]+F[1]*F[1])),1),-1));S[2]<0&&(U=2*Math.PI-U),l+=U}if(T||"multires"!=O&&"cubemap"!=O){if("multires"!=O){var z=2*Math.atan(Math.tan(.5*n)/(_.clientWidth/_.clientHeight));i=1/Math.tan(.5*z),T.uniform1f(C.psi,t),T.uniform1f(C.theta,e),T.uniform1f(C.rot,l),T.uniform1f(C.f,i),!0===H&&"equirectangular"==O&&(T.bindTexture(T.TEXTURE_2D,C.texture),T.texImage2D(T.TEXTURE_2D,0,T.RGB,T.RGB,T.UNSIGNED_BYTE,N)),T.drawArrays(T.TRIANGLES,0,6)}else{var B=g(n,_.clientWidth/_.clientHeight,.1,100);b(n);var G=[1,0,0,0,1,0,0,0,1];G=m(G=f(G=f(G=f(G,-l,"z"),-e,"x"),t,"y")),T.uniformMatrix4fv(C.perspUniform,!1,new Float32Array(v(B))),T.uniformMatrix4fv(C.cubeUniform,!1,new Float32Array(v(G)));var Y=P(B,G);if(C.nodeCache.sort(r),C.nodeCache.length>200&&C.nodeCache.length>C.currentNodes.length+50)for(var Z=C.nodeCache.splice(200,C.nodeCache.length-200),W=0;W<Z.length;W++)T.deleteTexture(Z[W].texture);C.currentNodes=[];var X=["f","b","u","d","l","r"];for(s=0;s<6;s++)p(Y,new d(D[s],X[s],1,0,0,N.fullpath),e,t,n);for(C.currentNodes.sort(h),W=0;W<C.currentNodes.length;W++)if(!C.currentNodes[W].texture){setTimeout(y(C.currentNodes[W]),0);break}u()}if(a.returnImage!==o)return _.toDataURL("image/png")}else{var q={f:"translate3d(-"+((s=L/2)+2)+"px, -"+(s+2)+"px, -"+s+"px)",b:"translate3d("+(s+2)+"px, -"+(s+2)+"px, "+s+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(s+2)+"px, -"+s+"px, "+(s+2)+"px) rotateX(270deg)",d:"translate3d(-"+(s+2)+"px, "+s+"px, -"+(s+2)+"px) rotateX(90deg)",l:"translate3d(-"+s+"px, -"+(s+2)+"px, "+(s+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+s+"px, -"+(s+2)+"px, -"+(s+2)+"px) rotateY(270deg)"},J=(i=1/Math.tan(n/2))*_.clientWidth/2+"px",Q="perspective("+J+") translateZ("+J+") rotateX("+e+"rad) rotateY("+t+"rad) ",j=Object.keys(q);for(W=0;W<6;W++){var V=A.querySelector(".pnlm-"+j[W]+"face").style;V.webkitTransform=Q+q[j[W]],V.transform=Q+q[j[W]]}}},this.isLoading=function(){if(T&&"multires"==O)for(var e=0;e<C.currentNodes.length;e++)if(!C.currentNodes[e].textureLoaded)return!0;return!1},this.getCanvas=function(){return _};var G=function(){function e(){var e=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin="anonymous",this.image.addEventListener("load",function(){w(e.image,e.texture),e.callback(e.texture),o(e)})}function t(e,t,o){this.src=e,this.texture=t,this.callback=o}function o(e){if(i.length){var t=i.shift();e.loadTexture(t.src,t.texture,t.callback)}else a[n++]=e}var n=4,a={},i=[];e.prototype.loadTexture=function(e,t,o){this.texture=t,this.callback=o,this.image.src=e};for(var r=0;r<n;r++)a[r]=new e;return function(e,o){var r=T.createTexture();return n?a[--n].loadTexture(e,r,o):i.push(new t(e,r,o)),r}}()}var a=["attribute vec2 a_texCoord;","varying vec2 v_texCoord;","void main() {","gl_Position = vec4(a_texCoord, 0.0, 1.0);","v_texCoord = a_texCoord;","}"].join(""),i=["attribute vec3 a_vertCoord;","attribute vec2 a_texCoord;","uniform mat4 u_cubeMatrix;","uniform mat4 u_perspMatrix;","varying mediump vec2 v_texCoord;","void main(void) {","gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);","v_texCoord = a_texCoord;","}"].join(""),r=["precision mediump float;","uniform float u_aspectRatio;","uniform float u_psi;","uniform float u_theta;","uniform float u_f;","uniform float u_h;","uniform float u_v;","uniform float u_vo;","uniform float u_rot;","const float PI = 3.14159265358979323846264;","uniform sampler2D u_image;","uniform samplerCube u_imageCube;","varying vec2 v_texCoord;","uniform vec4 u_backgroundColor;","void main() {","float x = v_texCoord.x * u_aspectRatio;","float y = v_texCoord.y;","float sinrot = sin(u_rot);","float cosrot = cos(u_rot);","float rot_x = x * cosrot - y * sinrot;","float rot_y = x * sinrot + y * cosrot;","float sintheta = sin(u_theta);","float costheta = cos(u_theta);","float a = u_f * costheta - rot_y * sintheta;","float root = sqrt(rot_x * rot_x + a * a);","float lambda = atan(rot_x / root, a / root) + u_psi;","float phi = atan((rot_y * costheta + u_f * sintheta) / root);"].join("\n"),s=r+["float cosphi = cos(phi);","gl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));","}"].join("\n"),l=r+["lambda = mod(lambda + PI, PI * 2.0) - PI;","vec2 coord = vec2(lambda / PI, phi / (PI / 2.0));","if(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)","gl_FragColor = u_backgroundColor;","else","gl_FragColor = texture2D(u_image, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));","}"].join("\n"),c=["varying mediump vec2 v_texCoord;","uniform sampler2D u_sampler;","void main(void) {","gl_FragColor = texture2D(u_sampler, v_texCoord);","}"].join("");return{renderer:function(e,t,o,a){return new n(e,t,o,a)}}}(window,document),window.pannellum=function(e,t,o){function n(n,a){function i(t){e.removeEventListener("deviceorientation",i),t&&null!==t.alpha&&null!==t.beta&&null!==t.gamma?(je.container.appendChild(je.orientation),Ve=!0,Ke&&se()):Ve=!1}function r(){var a=t.createElement("div");if(a.innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1!=a.getElementsByTagName("i").length){ge=ue.hfov,we=ue.pitch;var i,r;if("cubemap"==ue.type){for(fe=[],i=0;i<6;i++)fe.push(new Image),fe[i].crossOrigin="anonymous";Je.load.lbox.style.display="block",Je.load.lbar.style.display="none"}else if("multires"==ue.type){var u=JSON.parse(JSON.stringify(ue.multiRes));ue.basePath&&ue.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(ue.multiRes.basePath)?u.basePath=ue.basePath+ue.multiRes.basePath:ue.multiRes.basePath?u.basePath=ue.multiRes.basePath:ue.basePath&&(u.basePath=ue.basePath),fe=u}else if(!0===ue.dynamic)fe=ue.panorama;else{if(ue.panorama===o)return void h("No panorama image was specified.");fe=new Image}if("cubemap"==ue.type){var d=6,p=function(){0===--d&&l()},f=function(e){var o=t.createElement("a");o.href=e.target.src,o.innerHTML=o.href,h("The file "+o.outerHTML+" could not be accessed.")};for(i=0;i<fe.length;i++)fe[i].onload=p,fe[i].onerror=f,r=ue.cubeMap[i],ue.basePath&&!s(r)&&(r=ue.basePath+r),fe[i].src=encodeURI(r)}else if("multires"==ue.type)l();else if(r="",ue.basePath&&(r=ue.basePath),!0!==ue.dynamic){r=s(ue.panorama)?ue.panorama:r+ue.panorama,fe.onload=function(){e.URL.revokeObjectURL(this.src),l()};var m=new XMLHttpRequest;m.onloadend=function(){200==m.status?(c(this.response),Je.load.msg.innerHTML=""):fe.src=ue.error},m.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;Je.load.lbarFill.style.width=t+"%";var o,n,a;e.total>1e6?(o="MB",n=(e.loaded/1e6).toFixed(2),a=(e.total/1e6).toFixed(2)):e.total>1e3?(o="kB",n=(e.loaded/1e3).toFixed(1),a=(e.total/1e3).toFixed(1)):(o="B",n=e.loaded,a=e.total),Je.load.msg.innerHTML=n+" / "+a+" "+o}else Je.load.lbox.style.display="block",Je.load.lbar.style.display="none"};try{m.open("GET",r,!0)}catch(e){h("There is something wrong with the panorama URL.")}m.responseType="blob",m.setRequestHeader("Accept","image/*,*/*;q=0.9"),m.send()}n.classList.add("pnlm-grab"),n.classList.remove("pnlm-grabbing")}else h()}function s(e){return new RegExp("^(?:[a-z]+:)?//","i").test(e)||"/"==e[0]||"blob:"==e.slice(0,5)}function l(){de||(de=new libpannellum.renderer(We)),Ae||(Ae=!0,Xe.addEventListener("mousedown",f,!1),t.addEventListener("mousemove",w,!1),t.addEventListener("mouseup",y,!1),ue.mouseZoom&&(n.addEventListener("mousewheel",_,!1),n.addEventListener("DOMMouseScroll",_,!1)),ue.doubleClickZoom&&Xe.addEventListener("dblclick",v,!1),n.addEventListener("mozfullscreenchange",K,!1),n.addEventListener("webkitfullscreenchange",K,!1),n.addEventListener("msfullscreenchange",K,!1),n.addEventListener("fullscreenchange",K,!1),e.addEventListener("resize",k,!1),e.addEventListener("orientationchange",k,!1),n.addEventListener("keydown",C,!1),n.addEventListener("keyup",I,!1),n.addEventListener("blur",T,!1),t.addEventListener("mouseleave",y,!1),Xe.addEventListener("touchstart",b,!1),Xe.addEventListener("touchmove",P,!1),Xe.addEventListener("touchend",x,!1),Xe.addEventListener("pointerdown",M,!1),Xe.addEventListener("pointermove",E,!1),Xe.addEventListener("pointerup",R,!1),Xe.addEventListener("pointerleave",R,!1),ue.click&&Xe.addEventListener("click",m,!1),e.navigator.pointerEnabled&&(n.style.touchAction="none")),G(),setTimeout(function(){Le=!0},500)}function c(t){var n=new FileReader;n.addEventListener("loadend",function(){var a=n.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var i=a.indexOf("ÿÂ");(i<0||i>65536)&&h("Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).")}var r=a.indexOf("<x:xmpmeta");if(r>-1&&!0!==ue.ignoreGPanoXMP){var s=a.substring(r,a.indexOf("</x:xmpmeta>")+12),l=function(e){var t;return s.indexOf(e+'="')>=0?t=(t=s.substring(s.indexOf(e+'="')+e.length+2)).substring(0,t.indexOf('"')):s.indexOf(e+">")>=0&&(t=(t=s.substring(s.indexOf(e+">")+e.length+1)).substring(0,t.indexOf("<"))),t!==o?Number(t):null},c={fullWidth:l("GPano:FullPanoWidthPixels"),croppedWidth:l("GPano:CroppedAreaImageWidthPixels"),fullHeight:l("GPano:FullPanoHeightPixels"),croppedHeight:l("GPano:CroppedAreaImageHeightPixels"),topPixels:l("GPano:CroppedAreaTopPixels"),heading:l("GPano:PoseHeadingDegrees"),horizonPitch:l("GPano:PosePitchDegrees"),horizonRoll:l("GPano:PoseRollDegrees")};null!==c.fullWidth&&null!==c.croppedWidth&&null!==c.fullHeight&&null!==c.croppedHeight&&null!==c.topPixels&&(ze.indexOf("haov")<0&&(ue.haov=c.croppedWidth/c.fullWidth*360),ze.indexOf("vaov")<0&&(ue.vaov=c.croppedHeight/c.fullHeight*180),ze.indexOf("vOffset")<0&&(ue.vOffset=-180*((c.topPixels+c.croppedHeight/2)/c.fullHeight-.5)),null!==c.heading&&ze.indexOf("northOffset")<0&&(ue.northOffset=c.heading,!1!==ue.compass&&(ue.compass=!0)),null!==c.horizonPitch&&null!==c.horizonRoll&&(ze.indexOf("horizonPitch")<0&&(ue.horizonPitch=c.horizonPitch),ze.indexOf("horizonRoll")<0&&(ue.horizonRoll=c.horizonRoll)))}fe.src=e.URL.createObjectURL(t)}),n.readAsBinaryString!==o?n.readAsBinaryString(t):n.readAsText(t)}function h(e){e===o&&(e="Your browser does not have the necessary WebGL support to display this panorama."),Je.errorMsg.innerHTML="<p>"+e+"</p>",je.load.style.display="none",Je.load.box.style.display="none",Je.errorMsg.style.display="table",Se=!0,We.style.display="none",ce("error",e)}function u(){Se&&(Je.load.box.style.display="none",Je.errorMsg.style.display="none",Se=!1,ce("errorcleared"))}function d(e){var t=p(e);qe.style.left=t.x+"px",qe.style.top=t.y+"px",clearTimeout(d.t1),clearTimeout(d.t2),qe.style.display="block",qe.style.opacity=1,d.t1=setTimeout(function(){qe.style.opacity=0},2e3),d.t2=setTimeout(function(){qe.style.display="none"},2500),e.preventDefault()}function p(e){var t=n.getBoundingClientRect(),o={};return o.x=e.clientX-t.left,o.y=e.clientY-t.top,o}function f(e){if(e.preventDefault(),n.focus(),Ie&&ue.draggable){var t=p(e);if(ue.hotSpotDebug){var o=g(e);console.log("Pitch: "+o[0]+", Yaw: "+o[1]+", Center Pitch: "+ue.pitch+", Center Yaw: "+ue.yaw+", HFOV: "+ue.hfov)}ne(),re(),ue.roll=0,De.hfov=0,be=!0,Pe=Date.now(),xe=t.x,Me=t.y,Re=ue.yaw,_e=ue.pitch,n.classList.add("pnlm-grabbing"),n.classList.remove("pnlm-grab"),ye.hasMove=!1,ce("mousedown",e),N()}}function m(e){if(e.preventDefault(),n.focus(),Ie&&ue.draggable&&!ye.hasMove){var t=g(e);ce("click",e,{pitch:t[0],yaw:t[1]}),N()}}function v(e){if(ue.minHfov===ue.hfov)ye.setHfov(ge,1e3);else{var t=g(e);ye.lookAt(t[0],t[1],ue.minHfov,1e3)}}function g(e){var t=p(e),o=de.getCanvas(),n=o.clientWidth,a=o.clientHeight,i=t.x/n*2-1,r=(1-t.y/a*2)*a/n,s=1/Math.tan(ue.hfov*Math.PI/360),l=Math.sin(ue.pitch*Math.PI/180),c=Math.cos(ue.pitch*Math.PI/180),h=s*c-r*l,u=Math.sqrt(i*i+h*h);return[180*Math.atan((r*c+s*l)/u)/Math.PI,180*Math.atan2(i/u,h/u)/Math.PI+ue.yaw]}function w(e){if(ye.hasMove=!0,be&&Ie){Pe=Date.now();var t=de.getCanvas(),o=t.clientWidth,n=t.clientHeight,a=p(e),i=180*(Math.atan(xe/o*2-1)-Math.atan(a.x/o*2-1))/Math.PI*ue.hfov/90+Re;De.yaw=(i-ue.yaw)%360*.2,ue.yaw=i;var r=2*Math.atan(Math.tan(ue.hfov/360*Math.PI)*n/o)*180/Math.PI,s=180*(Math.atan(a.y/n*2-1)-Math.atan(Me/n*2-1))/Math.PI*r/90+_e;De.pitch=.2*(s-ue.pitch),ue.pitch=s}}function y(e){be&&(be=!1,Date.now()-Pe>15&&(De.pitch=De.yaw=0),n.classList.add("pnlm-grab"),n.classList.remove("pnlm-grabbing"),Pe=Date.now(),ce("mouseup",e))}function b(e){if(Ie&&ue.draggable){ne(),re(),ue.roll=0,De.hfov=0;var t=p(e.targetTouches[0]);if(xe=t.x,Me=t.y,2==e.targetTouches.length){var o=p(e.targetTouches[1]);xe+=.5*(o.x-t.x),Me+=.5*(o.y-t.y),Ee=Math.sqrt((t.x-o.x)*(t.x-o.x)+(t.y-o.y)*(t.y-o.y))}be=!0,Pe=Date.now(),Re=ue.yaw,_e=ue.pitch,ce("touchstart",e),N()}}function P(e){if(ue.draggable&&(e.preventDefault(),Ie&&(Pe=Date.now()),be&&Ie)){var t=p(e.targetTouches[0]),o=t.x,n=t.y;if(2==e.targetTouches.length&&-1!=Ee){var a=p(e.targetTouches[1]);o+=.5*(a.x-t.x),n+=.5*(a.y-t.y);var i=Math.sqrt((t.x-a.x)*(t.x-a.x)+(t.y-a.y)*(t.y-a.y));oe(ue.hfov+.1*(Ee-i)),Ee=i}var r=ue.hfov/360,s=(xe-o)*r+Re;De.yaw=(s-ue.yaw)%360*.2,ue.yaw=s;var l=(n-Me)*r+_e;De.pitch=.2*(l-ue.pitch),ue.pitch=l}}function x(){be=!1,Date.now()-Pe>150&&(De.pitch=De.yaw=0),Ee=-1,Pe=Date.now(),ce("touchend",event)}function M(e){"touch"==e.pointerType&&(et.push(e.pointerId),tt.push({clientX:e.clientX,clientY:e.clientY}),e.targetTouches=tt,b(e),e.preventDefault())}function E(e){if("touch"==e.pointerType)for(var t=0;t<et.length;t++)if(e.pointerId==et[t])return tt[t].clientX=e.clientX,tt[t].clientY=e.clientY,e.targetTouches=tt,void P(e)}function R(e){if("touch"==e.pointerType){for(var t=!1,n=0;n<et.length;n++)e.pointerId==et[n]&&(et[n]=o),et[n]&&(t=!0);t||(et=[],tt=[],x()),e.preventDefault()}}function _(e){Ie&&("fullscreenonly"!=ue.mouseZoom||Te)&&(e.preventDefault(),ne(),Pe=Date.now(),e.wheelDeltaY?(oe(ue.hfov-.05*e.wheelDeltaY),De.hfov=e.wheelDelta<0?1:-1):e.wheelDelta?(oe(ue.hfov-.05*e.wheelDelta),De.hfov=e.wheelDelta<0?1:-1):e.detail&&(oe(ue.hfov+1.5*e.detail),De.hfov=e.detail>0?1:-1),N())}function C(e){ne(),Pe=Date.now(),re(),ue.roll=0;var t=e.which||e.keycode;Ze.indexOf(t)<0||(e.preventDefault(),27==t?Te&&V():S(t,!0))}function T(){for(var e=0;e<10;e++)Ce[e]=!1}function I(e){var t=e.which||e.keycode;Ze.indexOf(t)<0||(e.preventDefault(),S(t,!1))}function S(e,t){var o=!1;switch(e){case 109:case 189:case 17:case 173:Ce[0]!=t&&(o=!0),Ce[0]=t;break;case 107:case 187:case 16:case 61:Ce[1]!=t&&(o=!0),Ce[1]=t;break;case 38:Ce[2]!=t&&(o=!0),Ce[2]=t;break;case 87:Ce[6]!=t&&(o=!0),Ce[6]=t;break;case 40:Ce[3]!=t&&(o=!0),Ce[3]=t;break;case 83:Ce[7]!=t&&(o=!0),Ce[7]=t;break;case 37:Ce[4]!=t&&(o=!0),Ce[4]=t;break;case 65:Ce[8]!=t&&(o=!0),Ce[8]=t;break;case 39:Ce[5]!=t&&(o=!0),Ce[5]=t;break;case 68:Ce[9]!=t&&(o=!0),Ce[9]=t}o&&t&&(me="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),N())}function L(){if(Ie){var e,t=!1,n=ue.pitch,a=ue.yaw,i=ue.hfov;e="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),me===o&&(me=e);var r=(e-me)*ue.hfov/1700;r=Math.min(r,1),Ce[0]&&!0===ue.keyboardZoom&&(oe(ue.hfov+(.8*De.hfov+.5)*r),t=!0),Ce[1]&&!0===ue.keyboardZoom&&(oe(ue.hfov+(.8*De.hfov-.2)*r),t=!0),(Ce[2]||Ce[6])&&(ue.pitch+=(.8*De.pitch+.2)*r,t=!0),(Ce[3]||Ce[7])&&(ue.pitch+=(.8*De.pitch-.2)*r,t=!0),(Ce[4]||Ce[8])&&(ue.yaw+=(.8*De.yaw-.2)*r,t=!0),(Ce[5]||Ce[9])&&(ue.yaw+=(.8*De.yaw+.2)*r,t=!0),t&&(Pe=Date.now());Date.now();if(ue.autoRotate){if(e-me>.001){var s=(e-me)/1e3,l=(De.yaw/s*r-.2*ue.autoRotate)*s;l=(-ue.autoRotate>0?1:-1)*Math.min(Math.abs(ue.autoRotate*s),Math.abs(l)),ue.yaw+=l}ue.autoRotateStopDelay&&(ue.autoRotateStopDelay-=e-me,ue.autoRotateStopDelay<=0&&(ue.autoRotateStopDelay=!1,He=ue.autoRotate,ue.autoRotate=0))}if(Fe.pitch&&(A("pitch"),n=ue.pitch),Fe.yaw&&(A("yaw"),a=ue.yaw),Fe.hfov&&(A("hfov"),i=ue.hfov),r>0&&!ue.autoRotate){Ce[4]||Ce[5]||Ce[8]||Ce[9]||Fe.yaw||(ue.yaw+=De.yaw*r*.85),Ce[2]||Ce[3]||Ce[6]||Ce[7]||Fe.pitch||(ue.pitch+=De.pitch*r*.85),Ce[0]||Ce[1]||Fe.hfov||oe(ue.hfov+De.hfov*r*.85)}if(me=e,r>0){De.yaw=.8*De.yaw+(ue.yaw-a)/r*.2,De.pitch=.8*De.pitch+(ue.pitch-n)/r*.2,De.hfov=.8*De.hfov+(ue.hfov-i)/r*.2;var c=ue.autoRotate?Math.abs(ue.autoRotate):5;De.yaw=Math.min(c,Math.max(De.yaw,-c)),De.pitch=Math.min(c,Math.max(De.pitch,-c)),De.hfov=Math.min(c,Math.max(De.hfov,-c))}Ce[0]&&Ce[0]&&(De.hfov=0),(Ce[2]||Ce[6])&&(Ce[3]||Ce[7])&&(De.pitch=0),(Ce[4]||Ce[8])&&(Ce[5]||Ce[9])&&(De.yaw=0)}}function A(e){var t=Fe[e],o=Math.min(1,Math.max((Date.now()-t.startTime)/1e3/(t.duration/1e3),0)),n=t.startPosition+ue.animationTimingFunction(o)*(t.endPosition-t.startPosition);if(t.endPosition>t.startPosition&&n>=t.endPosition||t.endPosition<t.startPosition&&n<=t.endPosition){n=t.endPosition,De[e]=0;var a=Fe[e].callback,i=Fe[e].callbackArgs;delete Fe[e],"function"==typeof a&&a(i)}ue[e]=n}function D(e){return e<.5?2*e*e:(4-2*e)*e-1}function k(){K()}function N(){ke||(ke=!0,O())}function O(){if(H(),ve&&clearTimeout(ve),be||Ne)requestAnimationFrame(O);else if(Ce[0]||Ce[1]||Ce[2]||Ce[3]||Ce[4]||Ce[5]||Ce[6]||Ce[7]||Ce[8]||Ce[9]||ue.autoRotate||Fe.pitch||Fe.yaw||Fe.hfov||Math.abs(De.yaw)>.01||Math.abs(De.pitch)>.01||Math.abs(De.hfov)>.01)L(),ue.autoRotateInactivityDelay>=0&&He&&Date.now()-Pe>ue.autoRotateInactivityDelay&&!ue.autoRotate&&(ue.autoRotate=He,ye.lookAt(we,o,ge,3e3)),requestAnimationFrame(O);else if(de&&(de.isLoading()||!0===ue.dynamic&&Be))requestAnimationFrame(O);else{ke=!1,me=o;var e=ue.autoRotateInactivityDelay-(Date.now()-Pe);e>0?ve=setTimeout(function(){ue.autoRotate=He,ye.lookAt(we,o,ge,3e3),N()},e):ue.autoRotateInactivityDelay>=0&&He&&(ue.autoRotate=He,ye.lookAt(we,o,ge,3e3),N())}}function H(){var e;if(Ie){ue.yaw>180?ue.yaw-=360:ue.yaw<-180&&(ue.yaw+=360),e=ue.yaw;var t=ue.maxYaw-ue.minYaw,o=-180,n=180;t<360&&(o=ue.minYaw+ue.hfov/2,n=ue.maxYaw-ue.hfov/2,t<ue.hfov&&(o=n=(o+n)/2)),ue.yaw=Math.max(o,Math.min(n,ue.yaw)),!1!==ue.autoRotate&&e!=ue.yaw&&(ue.autoRotate*=-1);var a=de.getCanvas(),i=2*Math.atan(Math.tan(ue.hfov/180*Math.PI*.5)/(a.width/a.height))/Math.PI*180,r=ue.minPitch+i/2,s=ue.maxPitch-i/2;ue.maxPitch-ue.minPitch<i&&(r=s=(r+s)/2),isNaN(r)&&(r=-90),isNaN(s)&&(s=90),ue.pitch=Math.max(r,Math.min(s,ue.pitch)),de.render(ue.pitch*Math.PI/180,ue.yaw*Math.PI/180,ue.hfov*Math.PI/180,{roll:ue.roll*Math.PI/180}),J(),ce("renderend",ue.pitch,"equirectangular"==ue.type?ue.yaw+90>180?ue.yaw+90-360:ue.yaw+90:ue.yaw,ue.hfov),ue.compass&&($e.style.transform="rotate("+(-ue.yaw-ue.northOffset)+"deg)",$e.style.webkitTransform="rotate("+(-ue.yaw-ue.northOffset)+"deg)")}}function F(e,t,o,n){this.w=e,this.x=t,this.y=o,this.z=n}function U(e,t,o){var n=[t?t*Math.PI/180/2:0,o?o*Math.PI/180/2:0,e?e*Math.PI/180/2:0],a=[Math.cos(n[0]),Math.cos(n[1]),Math.cos(n[2])],i=[Math.sin(n[0]),Math.sin(n[1]),Math.sin(n[2])];return new F(a[0]*a[1]*a[2]-i[0]*i[1]*i[2],i[0]*a[1]*a[2]-a[0]*i[1]*i[2],a[0]*i[1]*a[2]+i[0]*a[1]*i[2],a[0]*a[1]*i[2]+i[0]*i[1]*a[2])}function z(t,o,n){var a=U(t,o,n);a=a.multiply(new F(Math.sqrt(.5),-Math.sqrt(.5),0,0));var i=e.orientation?-e.orientation*Math.PI/180/2:0;return a.multiply(new F(Math.cos(i),0,-Math.sin(i),0))}function B(e){var t=z(e.alpha,e.beta,e.gamma).toEulerAngles();ue.pitch=t[0]/Math.PI*180,ue.roll=-t[1]/Math.PI*180,ue.yaw=-t[2]/Math.PI*180+ue.northOffset+Oe}function G(){try{var e={};ue.horizonPitch!==o&&(e.horizonPitch=ue.horizonPitch*Math.PI/180),ue.horizonRoll!==o&&(e.horizonRoll=ue.horizonRoll*Math.PI/180),ue.backgroundColor!==o&&(e.backgroundColor=ue.backgroundColor),de.init(fe,ue.type,ue.dynamic,ue.haov*Math.PI/180,ue.vaov*Math.PI/180,ue.vOffset*Math.PI/180,Y,e),!0!==ue.dynamic&&(fe=o)}catch(e){if("webgl error"==e.type||"no webgl"==e.type)h();else{if("webgl size error"!=e.type)throw h("Unknown error. Check developer console."),e;h("This panorama is too big for your device! It's "+e.width+"px wide, but your device only supports images up to "+e.maxWidth+"px wide. Try another device. (If you're the author, try scaling down the image.)")}}}function Y(){if(ue.sceneFadeDuration&&de.fadeImg!==o){de.fadeImg.style.opacity=0;var e=de.fadeImg;delete de.fadeImg,setTimeout(function(){We.removeChild(e),ce("scenechangefadedone")},ue.sceneFadeDuration)}ue.compass?$e.style.display="inline":$e.style.display="none",W(),Je.load.box.style.display="none",pe!==o&&(We.removeChild(pe),pe=o),Ie=!0,ce("load",ue.sceneId),N()}function Z(e){e.pitch=Number(e.pitch)||0,e.yaw=Number(e.yaw)||0;var o=t.createElement("div");o.className="pnlm-hotspot-base",o.id=e.id,e.cssClass?o.className+=" "+e.cssClass:o.className+="  pnlm-"+le(e.type);var n=t.createElement("span");e.text&&(n.innerHTML=le(e.text));var a;if(e.video){var i=t.createElement("video"),r=e.video;i.src=encodeURI(r),i.controls=!0,i.style.width=e.width+"px",We.appendChild(o),n.appendChild(i)}else if(e.image){r=e.image;a=t.createElement("a"),n.appendChild(a);var s=t.createElement("img");s.src=encodeURI(r),s.style.width=e.width+"px",s.style.paddingTop="5px",We.appendChild(o),a.appendChild(s),n.style.maxWidth="initial"}else e.URL?(a=t.createElement("a"),We.appendChild(a),o.style.cursor="pointer",n.style.cursor="pointer",a.appendChild(o)):(e.sceneId&&(o.onclick=o.ontouchend=function(){return o.clicked||(o.clicked=!0,ie(e.sceneId,e.targetPitch,e.targetYaw,e.targetHfov)),!1},o.style.cursor="pointer",n.style.cursor="pointer"),We.appendChild(o));e.createTooltipFunc?e.createTooltipFunc(o,e.createTooltipArgs):(e.text||e.video||e.image)&&(o.appendChild(n),n.style.width=n.scrollWidth-20+"px"),e.clickHandlerFunc&&(o.addEventListener("click",function(t){e.clickHandlerFunc&&e.clickHandlerFunc(t,e.clickHandlerArgs)},"false"),o.style.cursor="pointer",n.style.cursor="pointer"),e.div=o}function W(){Ge||(ue.hotSpots?(ue.hotSpots=ue.hotSpots.sort(function(e,t){return e.pitch<t.pitch}),ue.hotSpots.forEach(Z)):(ue.hotSpotDic={},ue.hotSpots=[]),Ge=!0,J())}function X(){var e=ue.hotSpots;if(Ge=!1,delete ue.hotSpots,delete ue.hotSpotDic,e)for(var t=0;t<e.length;t++){for(var o=e[t].div;o.parentNode!=We;)o=o.parentNode;We.removeChild(o),delete e.div}}function q(e){var t=Math.sin(e.pitch*Math.PI/180),o=Math.cos(e.pitch*Math.PI/180),n=Math.sin(ue.pitch*Math.PI/180),a=Math.cos(ue.pitch*Math.PI/180),i=Math.cos((-e.yaw+ue.yaw)*Math.PI/180),r=t*n+o*i*a;if(e.yaw<=90&&e.yaw>-90&&r<=0||(e.yaw>90||e.yaw<=-90)&&r<=0)e.div.style.visibility="hidden";else{var s=Math.sin((-e.yaw+ue.yaw)*Math.PI/180),l=Math.tan(ue.hfov*Math.PI/360);e.div.style.visibility="visible";var c=de.getCanvas(),h=c.clientWidth,u=c.clientHeight,d=[-h/l*s*o/r/2,-h/l*(t*a-o*i*n)/r/2],p=Math.sin(ue.roll*Math.PI/180),f=Math.cos(ue.roll*Math.PI/180);(d=[d[0]*f-d[1]*p,d[0]*p+d[1]*f])[0]+=(h-e.div.offsetWidth)/2,d[1]+=(u-e.div.offsetHeight)/2;var m="translate("+d[0]+"px, "+d[1]+"px) translateZ(9999px) rotate("+ue.roll+"deg)";e.div.style.webkitTransform=m,e.div.style.MozTransform=m,e.div.style.transform=m}}function J(){ue.hotSpots.forEach(q)}function Q(e){ue={};var t,o=["haov","vaov","vOffset","northOffset","horizonPitch","horizonRoll"];ze=[];for(t in Ye)Ye.hasOwnProperty(t)&&(ue[t]=Ye[t]);for(t in a.default)a.default.hasOwnProperty(t)&&(ue[t]=a.default[t],o.indexOf(t)>=0&&ze.push(t));if(null!==e&&""!==e&&a.scenes&&a.scenes[e]){var n=a.scenes[e];n.sceneId||(n.sceneId=e);for(t in n)n.hasOwnProperty(t)&&(ue[t]=n[t],o.indexOf(t)>=0&&ze.push(t));ue.scene=e}for(t in a)a.hasOwnProperty(t)&&(ue[t]=a[t],o.indexOf(t)>=0&&ze.push(t));"equirectangular"==ue.type&&(ue.yaw+=270)}function j(e){if((e=e||!1)&&"preview"in ue){var n=ue.preview;ue.basePath&&!s(n)&&(n=ue.basePath+n),(pe=t.createElement("div")).className="pnlm-preview-img",pe.style.backgroundImage="url('"+encodeURI(n)+"')",We.appendChild(pe)}var a=ue.title,i=ue.author;e&&("previewTitle"in ue&&(ue.title=ue.previewTitle),"previewAuthor"in ue&&(ue.author=ue.previewAuthor)),ue.hasOwnProperty("title")||(Je.title.innerHTML=""),ue.hasOwnProperty("author")||(Je.author.innerHTML=""),ue.hasOwnProperty("title")||ue.hasOwnProperty("author")||(Je.container.style.display="none");for(var l in ue)if(ue.hasOwnProperty(l))switch(l){case"title":Je.title.innerHTML=le(ue[l]),Je.container.style.display="inline";break;case"author":Je.author.innerHTML="by "+le(ue[l]),Je.container.style.display="inline";break;case"fallback":Je.errorMsg.innerHTML='<p>Your browser does not support WebGL.<br><a href="'+encodeURI(ue[l])+'" target="_blank">Click here to view this panorama in an alternative viewer.</a></p>';break;case"hfov":oe(Number(ue[l]));break;case"autoLoad":!0===ue[l]&&de===o&&(Je.load.box.style.display="inline",je.load.style.display="none",r());break;case"showZoomCtrl":ue[l]&&0!=ue.showControls?je.zoom.style.display="block":je.zoom.style.display="none";break;case"showFullscreenCtrl":ue[l]&&0!=ue.showControls&&("fullscreen"in t||"mozFullScreen"in t||"webkitIsFullScreen"in t||"msFullscreenElement"in t)?je.fullscreen.style.display="block":je.fullscreen.style.display="none";break;case"hotSpotDebug":ue[l]?Qe.style.display="block":Qe.style.display="none";break;case"showControls":ue[l]||(je.orientation.style.display="none",je.zoom.style.display="none",je.fullscreen.style.display="none");break;case"orientationOnByDefault":ue[l]&&(Ve===o?Ke=!0:!0===Ve&&se());break;case"loadButtonLabel":je.load.innerHTML="<p>"+le(ue[l])+"</p>"}e&&(a?ue.title=a:delete ue.title,i?ue.author=i:delete ue.author)}function V(){if(Ie&&!Se)if(Te)t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen();else try{n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.msRequestFullscreen?n.msRequestFullscreen():n.webkitRequestFullScreen()}catch(e){}}function K(){t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement?(je.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),Te=!0):(je.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),Te=!1),de.resize(),oe(ue.hfov),N()}function $(){Ie&&(oe(ue.hfov-5),N())}function ee(){Ie&&(oe(ue.hfov+5),N())}function te(e){var t=ue.minHfov;return"multires"==ue.type&&de&&(t=Math.min(t,de.getCanvas().width/(ue.multiRes.cubeResolution/90*.9))),t>ue.maxHfov?(console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),ue.hfov):e<t?t:e>ue.maxHfov?ue.maxHfov:e}function oe(e){ue.hfov=te(e)}function ne(){Fe={},He=ue.autoRotate?ue.autoRotate:He,ue.autoRotate=!1}function ae(){u(),je.load.style.display="none",Je.load.box.style.display="inline",r()}function ie(e,t,n,i,r){Ie=!1,Fe={};var s,l,c,h;if(ue.sceneFadeDuration&&!r){(s=new Image).className="pnlm-fade-img",s.style.transition="opacity "+ue.sceneFadeDuration/1e3+"s",s.style.width="100%",s.style.height="100%",s.onload=function(){ie(e,t,n,i,!0)};var u=de.render(ue.pitch*Math.PI/180,ue.yaw*Math.PI/180,ue.hfov*Math.PI/180,{returnImage:!0});return u!==o&&(s.src=u),We.appendChild(s),void(de.fadeImg=s)}l="same"===t?ue.pitch:t,c="same"===n?ue.yaw:"sameAzimuth"===n?ue.yaw+ue.northOffset-a.scenes[e].northOffset:n,h="same"===i?ue.hfov:i,X(),Q(e),De.yaw=De.pitch=De.hfov=0,j(),l!==o&&(ue.pitch=l),c!==o&&(ue.yaw=c),h!==o&&(ue.hfov=h),ce("scenechange",e),ae()}function re(){e.removeEventListener("deviceorientation",B),je.orientation.classList.remove("pnlm-orientation-button-active"),Ne=!1}function se(){Ne=!0,Oe=ue.yaw,e.addEventListener("deviceorientation",B),je.orientation.classList.add("pnlm-orientation-button-active"),requestAnimationFrame(O)}function le(e){return a.escapeHTML?String(e).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):String(e).split("\n").join("<br>")}function ce(e){if(e in Ue)for(var t=0;t<Ue[e].length;t++)Ue[e][t].apply(null,[].slice.call(arguments,1))}function he(){return ot+++"_"+(new Date).getTime()}var ue,de,pe,fe,me,ve,ge,we,ye=this,be=!1,Pe=Date.now(),xe=0,Me=0,Ee=-1,Re=0,_e=0,Ce=new Array(10),Te=!1,Ie=!1,Se=!1,Le=!1,Ae=!1,De={yaw:0,pitch:0,hfov:0},ke=!1,Ne=!1,Oe=0,He=0,Fe={},Ue={},ze=[],Be=!1,Ge=!1,Ye={northDir:0,hfov:120,minHfov:50,maxHfov:120,pitch:6,minPitch:o,maxPitch:o,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:o,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!1,autoLoad:!0,showControls:!1,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],animationTimingFunction:D,loadButtonLabel:"单击加载全景",draggable:!0,error:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAO8AAAC0CAIAAADzW+zaAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHaSURBVHhe7dIBDQAADMOg+ze9+2hAAzeosJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZDpvpsJkOm+mwmQ6b6bCZiu0BBnpJRzwSHHkAAAAASUVORK5CYII="},Ze=[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189];(n="string"==typeof n?t.getElementById(n):n).classList.add("pnlm-container"),n.tabIndex=0;var We=t.createElement("div");We.className="pnlm-render-container",n.appendChild(We);var Xe=t.createElement("div");Xe.className="pnlm-dragfix",n.appendChild(Xe);var qe=t.createElement("span");qe.className="pnlm-about-msg",qe.innerHTML='<a href="https://pannellum.org/" target="_blank">Pannellum</a>',qe.style.display="none",Xe.addEventListener("contextmenu",d);var Je={},Qe=t.createElement("div");Qe.className="pnlm-sprite pnlm-hot-spot-debug-indicator",n.appendChild(Qe),Je.container=t.createElement("div"),Je.container.className="pnlm-panorama-info",Je.title=t.createElement("div"),Je.title.className="pnlm-title-box",Je.container.appendChild(Je.title),Je.author=t.createElement("div"),Je.author.className="pnlm-author-box",Je.container.appendChild(Je.author),n.appendChild(Je.container),Je.load={},Je.load.box=t.createElement("div"),Je.load.box.className="pnlm-load-box",Je.load.box.innerHTML="<p>加载中...</p>",Je.load.lbox=t.createElement("div"),Je.load.lbox.className="pnlm-lbox",Je.load.lbox.innerHTML='<div class="pnlm-loading"></div>',Je.load.box.appendChild(Je.load.lbox),Je.load.lbar=t.createElement("div"),Je.load.lbar.className="pnlm-lbar",Je.load.lbarFill=t.createElement("div"),Je.load.lbarFill.className="pnlm-lbar-fill",Je.load.lbar.appendChild(Je.load.lbarFill),Je.load.box.appendChild(Je.load.lbar),Je.load.msg=t.createElement("p"),Je.load.msg.className="pnlm-lmsg",Je.load.box.appendChild(Je.load.msg),n.appendChild(Je.load.box),Je.errorMsg=t.createElement("div"),Je.errorMsg.className="pnlm-error-msg pnlm-info-box",n.appendChild(Je.errorMsg);var je={};je.container=t.createElement("div"),je.container.className="pnlm-controls-container",n.appendChild(je.container),je.load=t.createElement("div"),je.load.className="pnlm-load-button",je.load.addEventListener("click",function(){j(),ae()}),n.appendChild(je.load),je.zoom=t.createElement("div"),je.zoom.className="pnlm-zoom-controls pnlm-controls",je.zoomIn=t.createElement("div"),je.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",je.zoomIn.addEventListener("click",$),je.zoom.appendChild(je.zoomIn),je.zoomOut=t.createElement("div"),je.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",je.zoomOut.addEventListener("click",ee),je.zoom.appendChild(je.zoomOut),je.container.appendChild(je.zoom),je.fullscreen=t.createElement("div"),je.fullscreen.addEventListener("click",V),je.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(t.fullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled||t.msFullscreenEnabled)&&je.container.appendChild(je.fullscreen),je.orientation=t.createElement("div"),je.orientation.addEventListener("click",function(e){Ne?re():se()}),je.orientation.addEventListener("mousedown",function(e){e.stopPropagation()}),je.orientation.addEventListener("touchstart",function(e){e.stopPropagation()}),je.orientation.addEventListener("pointerdown",function(e){e.stopPropagation()}),je.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control";var Ve,Ke=!1;e.DeviceOrientationEvent?e.addEventListener("deviceorientation",i):Ve=!1;var $e=t.createElement("div");$e.className="pnlm-compass pnlm-controls pnlm-control",n.appendChild($e),Q(a.firstScene?a.firstScene:a.default&&a.default.firstScene?a.default.firstScene:null),j(!0);var et=[],tt=[];F.prototype.multiply=function(e){return new F(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.x*e.w+this.w*e.x+this.y*e.z-this.z*e.y,this.y*e.w+this.w*e.y+this.z*e.x-this.x*e.z,this.z*e.w+this.w*e.z+this.x*e.y-this.y*e.x)},F.prototype.toEulerAngles=function(){return[Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.isLoaded=function(){return Ie},this.getPitch=function(){return ue.pitch},this.setPitch=function(e,t,n,a){return t=t==o?1e3:Number(t),t?Fe.pitch={startTime:Date.now(),startPosition:ue.pitch,endPosition:e,duration:t,callback:n,callbackArgs:a}:ue.pitch=e,N(),this},this.getPitchBounds=function(){return[ue.minPitch,ue.maxPitch]},this.setPitchBounds=function(e){return ue.minPitch=Math.max(-90,Math.min(e[0],90)),ue.maxPitch=Math.max(-90,Math.min(e[1],90)),this},this.getYaw=function(){return"equirectangular"==ue.type?ue.yaw+90>180?ue.yaw+90-360:ue.yaw+90:ue.yaw},this.setYaw=function(e,t,n,a){return t=t==o?1e3:Number(t),t?Fe.yaw={startTime:Date.now(),startPosition:ue.yaw,endPosition:"equirectangular"==ue.type?e-90:e,duration:t,callback:n,callbackArgs:a}:ue.yaw=e,N(),this},this.getYawBounds=function(){return[ue.minYaw,ue.maxYaw]},this.setYawBounds=function(e){return ue.minYaw=Math.max(-180,Math.min(e[0],180)),ue.maxYaw=Math.max(-180,Math.min(e[1],180)),this},this.getHfov=function(){return ue.hfov},this.setHfov=function(e,t,n,a){return t=t==o?1e3:Number(t),t?Fe.hfov={startTime:Date.now(),startPosition:ue.hfov,endPosition:te(e),duration:t,callback:n,callbackArgs:a}:oe(e),N(),this},this.getHfovBounds=function(){return[ue.minHfov,ue.maxHfov]},this.setHfovBounds=function(e){return ue.minHfov=Math.max(0,e[0]),ue.maxHfov=Math.max(0,e[1]),this},this.lookAt=function(e,t,n,a,i,r){return a=a==o?1e3:Number(a),e!==o&&(this.setPitch(e,a,i,r),i=o),t!==o&&(this.setYaw(t,a,i,r),i=o),n!==o&&this.setHfov(n,a,i,r),this},this.getNorthOffset=function(){return ue.northOffset},this.setNorthOffset=function(e){return ue.northOffset=Math.min(360,Math.max(0,e)),N(),this},this.startAutoRotate=function(e){return e=e||He||1,ue.autoRotate=e,ye.lookAt(we,o,ge,3e3),N(),this},this.stopAutoRotate=function(){return He=ue.autoRotate?ue.autoRotate:He,ue.autoRotate=!1,ue.autoRotateInactivityDelay=-1,this},this.getRenderer=function(){return de},this.setUpdate=function(e){return Be=!0===e,de===o?l():N(),this},this.mouseEventToCoords=function(e){return g(e)},this.loadScene=function(e,t,o,n){return Ie&&ie(e,t,o,n),this},this.getScene=function(){return ue.scene},this.getSceneById=function(e){return a.scenes[e]},this.addScene=function(e,t,o){return t.sceneId=e,!a.scenes&&(a.scenes=[]),a.scenes[e]=t,o&&this.loadScene(e),this},this.removeScene=function(e){return!(ue.scene===e||!a.scenes.hasOwnProperty(e))&&(delete a.scenes[e],!0)},this.toggleFullscreen=function(){return V(),this},this.getConfig=function(){return ue},this.addHotSpot=function(e,t){if(e.id||(e.id=he()),t===o&&ue.scene===o){if(ue.hotSpotDic||(ue.hotSpotDic={}),ue.hotSpots||(ue.hotSpots=[]),ue.hotSpotDic[e.id])return!0;ue.hotSpots.push(e),ue.hotSpotDic[e.id]=e}else{var n=t!==o?t:ue.scene;if(!a.scenes.hasOwnProperty(n))throw"Invalid scene ID!";if(a.scenes[n].hasOwnProperty("hotSpots")||(a.scenes[n].hotSpotDic={},a.scenes[n].hotSpots=[],n==ue.scene&&(ue.hotSpots=a.scenes[n].hotSpots)),a.scenes[n].hotSpotDic[e.id])return!0;a.scenes[n].hotSpots.push(e),a.scenes[n].hotSpotDic[e.id]=e}return t!==o&&ue.scene!=t||(Z(e),q(e)),this},this.removeHotSpot=function(e){if(!ue.hotSpots)return!1;if(e&&e.id)return this.removeHotSpot(e.id);for(var t=0;t<ue.hotSpots.length;t++)if(ue.hotSpots[t].hasOwnProperty("id")&&ue.hotSpots[t].id===e){for(var o=ue.hotSpots[t].div;o.parentNode!=We;)o=o.parentNode;return We.removeChild(o),delete ue.hotSpots[t].div,ue.hotSpots.splice(t,1),!0}return!1},this.clearHotSpot=function(){for(var e=0;e<ue.hotSpots.length;e++){for(var t=ue.hotSpots[e].div;t.parentNode!=We;)t=t.parentNode;We.removeChild(t),delete ue.hotSpots[e].div}ue.hotSpots=[],ue.hotSpotDic={}},this.resize=function(){k()},this.isLoaded=function(){return Ie},this.on=function(e,t){return Ue[e]=Ue[e]||[],Ue[e].push(t),this},this.off=function(e,t){if(!e)return Ue={},this;if(t){var o=Ue[e].indexOf(t);o>=0&&Ue[e].splice(o,1),(Ue[e].length=0)&&delete Ue[e]}else delete Ue[e];return this},this.destroy=function(){de&&de.destroy(),Ae&&(Xe.removeEventListener("click",m,!1),Xe.removeEventListener("mousedown",f,!1),Xe.removeEventListener("dblclick",v,!1),t.removeEventListener("mousemove",w,!1),t.removeEventListener("mouseup",y,!1),n.removeEventListener("mousewheel",_,!1),n.removeEventListener("DOMMouseScroll",_,!1),n.removeEventListener("mozfullscreenchange",K,!1),n.removeEventListener("webkitfullscreenchange",K,!1),n.removeEventListener("msfullscreenchange",K,!1),n.removeEventListener("fullscreenchange",K,!1),e.removeEventListener("resize",k,!1),e.removeEventListener("orientationchange",k,!1),n.removeEventListener("keydown",C,!1),n.removeEventListener("keyup",I,!1),n.removeEventListener("blur",T,!1),t.removeEventListener("mouseleave",y,!1),Xe.removeEventListener("touchstart",b,!1),Xe.removeEventListener("touchmove",P,!1),Xe.removeEventListener("touchend",x,!1),Xe.removeEventListener("pointerdown",M,!1),Xe.removeEventListener("pointermove",E,!1),Xe.removeEventListener("pointerup",R,!1),Xe.removeEventListener("pointerleave",R,!1)),n.innerHTML="",n.classList.remove("pnlm-container"),n.classList.remove("pnlm-grab"),n.classList.remove("pnlm-grabbing"),Ue={}},this.getYawAndPitchByEvent=function(e){var t=g(e);return{pitch:t[0],yaw:t[1]}},this.renderHotSpot=function(e,t,o){q({div:e.div,pitch:t,yaw:o})},this.getContainer=function(){return n},this.getDragFix=function(){return Xe};var ot=0}return{viewer:function(e,t){return new n(e,t)}}}(window,document),window.NPPano={version:"1.2.0",canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}()},NPPano.viewer=function(e,t){if(!NPPano.canvas||!NPPano.webgl)throw"浏览器不支持webgl，不能生成全景！";this._viwer=window.pannellum.viewer(e,t)},NPPano.viewer.createNPPano=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{autoLoad:!0,autoRotate:!0,showZoomCtrl:!0,showControls:!0,maxHfov:90,location:"/server2428088/netposa/panorama/img/"};o.scenes={};for(var n=t.length-1;n>=0;n--){var a=t[n],i=a.senceId||a.panoid||a.id;a.basePath=i+"/",a.type=a.type||"cubemap","cubemap"==a.type?a.cubeMap=["l.jpg","f.jpg","r.jpg","b.jpg","u.jpg","d.jpg"]:"equirectangular"!=a.type&&"panorama"!=a.type||(a.panorama=i+".jpg",a.type="equirectangular"),a.senceId=i,a.title=a.title||a.name,o.scenes[i]=a}if(o.default=o.default||{firstScene:o.firstScene||t[t.length-1].panoid,sceneFadeDuration:2e3,yaw:180,minPitch:-45},delete o.firstScene,o.location&&o.scenes)for(var r in o.scenes)o.scenes[r].basePath&&(o.scenes[r].basePath=o.location+o.scenes[r].basePath);return new NPPano.viewer(e,o)},NPPano.viewer.prototype={addScene:function(e,t){return this._viwer.addScene(e.sceneId,e,t)},getCurrentSence:function(){var e=this._viwer.getConfig();return e.scenes[e.sceneId]},removeScene:function(e){return this._viwer.removeScene(e.sceneId)},addHotSpot:function(e){return this._viwer.addHotSpot(e,e.targetSceneId)},addGeoMarker:function(e){var t=NPPano.Util.CavertScenePosition(e.point,this);return e.pitch=t.pitch,e.yaw=t.yaw,this.addHotSpot(e)},removeHotSpot:function(e){return this._viwer.removeHotSpot(e)},mouseEventToCoords:function(e){return this._viwer.getYawAndPitchByEvent(e)},on:function(e,t){this._viwer.on(e,t)},off:function(e,t){this._viwer.off(e,t)},resize:function(){this._viwer.resize()},clearHotSpot:function(){this._viwer.clearHotSpot()},toggleFullscreen:function(){this._viwer.toggleFullscreen()},getSceneById:function(e){return this._viwer.getSceneById(e)},loadScene:function(e){this._viwer.loadScene(e.sceneId||e)},loadSceneById:function(e){this._viwer.loadScene(e)},getContainer:function(){return this._viwer.getContainer()},getDragFix:function(){return this._viwer.getDragFix()},renderHotSpot:function(e,t,o){this._viwer.renderHotSpot(e,t,o)},getYaw:function(){return this._viwer.getYaw()},setYaw:function(e){this._viwer.setYaw(e)},getHfov:function(){return this._viwer.getHfov()},setHfov:function(e){this._viwer.setHfov(e)},setPitch:function(e){this._viwer.setPitch(e)},getPitch:function(){return this._viwer.getPitch()},getAllSenceIds:function(){var e=this._viwer.getConfig().scenes,t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(o);return t},destroyed:!1,destroy:function(){!this.destroyed&&this._viwer&&this._viwer.destroy(),delete this._viwer,this.destroyed=!0}},NPPano.Util={},NPPano.Util.ImageHotSpotMove={active:function(e,t){e.getDragFix();var o=t.div,n=function(n){var a=e.mouseEventToCoords(n);t.pitch=a.pitch,t.yaw=a.yaw;var i="drag"==n.type;return e.renderHotSpot(t,a.pitch,a.yaw),i?(t.moving=i,o.style.cursor="move"):(delete t.moving,o.style.cursor=""),console.log(e.getDragFix().style.cursor),i},a=function(e){e.dataTransfer&&(e.dataTransfer.effectAllowed="linkMove",event.dataTransfer.setData("Text",event.target))};o.addEventListener("dragstart",a,!1),o.addEventListener("dragend",n,!1),o.addEventListener("drag",n,!1),o.draggable=!0,t.mousedown=a,t.mouseup=n},deactive:function(e){if(e.div&&e.mousedown){var t=e.div;t.removeEventListener("mousedown",mousedown,!1),t.removeEventListener("dragend",mousemove,!1),t.removeEventListener("drag",mousemove,!1),t.removeEventListener("dragstart",mousedown,!1),delete e.mousedown,delete e.mouseup}}},NPPano.inherits=function(e,t){var o=e.prototype,n=t.prototype;for(var a in o)n[a]=o[a];t.prototype.constructor=t},NPPano.Scene=function(e,t,o,n){if(this.type=o||"equirectangular",this.sceneId=e,this.title=t,this.hotSpots=[],this.hotSpotDic={},n)for(var a in n)n.hasOwnProperty(a)&&(this[a]=n[a])},NPPano.Scene.prototype={},NPPano.HotSpot=function(e,t,o){if(this.pitch=e,this.yaw=t,o)for(var n in o)o.hasOwnProperty(n)&&(this[n]=o[n])},NPPano.HotSpot.prototype={on:function(e,t){e="click"==e?"clickHandlerFunc":e,this.clickHandlerArgs=this,this[e]=t},off:function(e){this[e="click"==e?"clickHandlerFunc":e]=null},setScene:function(e){e&&e.sceneId&&(this.targetSceneId=e.sceneId)},setCreateTooltipFunc:function(e){this.createTooltipFunc=e,this.createTooltipArgs=this}},NPPano.Label=function(e,t,o,n){NPPano.HotSpot.call(this,t,o,n),this.text=e},NPPano.inherits(NPPano.HotSpot,NPPano.Label),NPPano.TextHotSpot=NPPano.Label,NPPano.SceneHotSpot=function(e,t,o,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pnlm-hotspot pnlm-sprite pnlm-scene pnlm-tooltip";this.sceneId=e,this.cssClass=a,t&&(this.targetPitch=t,this.pitch=t),o&&(this.targetYaw=o,this.yaw=o),n&&(this.targetHfov=n)},NPPano.SceneHotSpot.prototype={setScene:function(e){e&&e.sceneId&&(this.sceneId=e.sceneId)}},NPPano.inherits(NPPano.HotSpot,NPPano.SceneHotSpot),NPPano.Marker=function(e,t,o,n){NPPano.HotSpot.call(this,t,o,n),this.image=e},NPPano.GeoMarker=function(e,t,o){NPPano.HotSpot.call(this,0,0,o),this.image=e,this.point=t},NPPano.inherits(NPPano.HotSpot,NPPano.Marker),NPPano.ImageHotSpot=NPPano.Marker,NPPano.Util.CavertScenePosition=function(e,t){if(!t)return{pitch:0,yaw:0};var o=t.getCurrentSence();if(!o.x||!o.y)return{pitch:0,yaw:0};e.z=e.z?e.z:6;var n=NPPano.Util.webMoctorJW2PM(o.x,o.y),a=NPPano.Util.webMoctorJW2PM(e.lon,e.lat),i=0;i=a.lon-n.lon<0?270-Math.atan((a.lat-n.lat)/(a.lon-n.lon))/Math.PI*180-o.northdir:90-Math.atan((a.lat-n.lat)/(a.lon-n.lon))/Math.PI*180-o.northdir,i%=360;var r=Math.sqrt((a.lat-n.lat)*(a.lat-n.lat)+(a.lon-n.lon)*(a.lon-n.lon));return{pitch:Math.atan((e.z-1.6)/r)/Math.PI*180,yaw:i}},NPPano.Util.webMoctorJW2PM=function(e,t){var o={lon:0,lat:0};e=parseFloat(e),t=parseFloat(t),o.lon=e/180*20037508.34,t>85.05112&&(t=85.05112),t<-85.05112&&(t=-85.05112),t=Math.PI/180*t;var n=Math.PI/4+t/2;return o.lat=20037508.34*Math.log(Math.tan(n))/Math.PI,o};